<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="SwitchBot制御">
    <meta name="theme-color" content="#007AFF">

    <title>SwitchBot自動制御</title>
    <meta name="description" content="位置情報ベースのSwitchBotエアコン自動制御PWA">

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">

    <!-- iOS Icons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-192x192.png">

    <!-- Stylesheet -->
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>🏠 SwitchBot制御</h1>
            <div class="status-indicator" id="connectionStatus">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">待機中</span>
            </div>
        </header>

        <!-- Main Content -->
        <main class="app-main">

            <!-- Location Info Card -->
            <section class="info-card">
                <h2>📍 位置情報</h2>
                <div class="info-grid">
                    <div class="info-item">
                        <label>現在位置:</label>
                        <span id="currentLocation">取得中...</span>
                    </div>
                    <div class="info-item">
                        <label>自宅からの距離:</label>
                        <span id="distanceFromHome">-- m</span>
                    </div>
                    <div class="info-item">
                        <label>監視状態:</label>
                        <span id="monitoringStatus">停止中</span>
                    </div>
                    <div class="info-item">
                        <label>最後の制御:</label>
                        <span id="lastControl">--</span>
                    </div>
                </div>
            </section>

            <!-- Control Card -->
            <section class="control-card">
                <h2>🎛️ 制御</h2>
                <div class="control-buttons">
                    <button id="toggleMonitoringBtn" class="btn btn-primary">
                        <span id="monitoringBtnText">監視開始</span>
                    </button>
                    <button id="manualOnBtn" class="btn btn-success">
                        エアコンON
                    </button>
                    <button id="manualOffBtn" class="btn btn-warning">
                        エアコンOFF
                    </button>
                    <button id="settingsBtn" class="btn btn-outline">
                        ⚙️ 設定
                    </button>
                </div>
            </section>

            <!-- Log Card -->
            <section class="log-card">
                <h2>📝 実行ログ</h2>
                <div class="log-container" id="logContainer">
                    <!-- ログがここに動的に追加されます -->
                </div>
                <button id="clearLogBtn" class="btn btn-small">ログクリア</button>
            </section>

        </main>

        <!-- Settings Modal -->
        <div class="modal" id="settingsModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>⚙️ 設定</h3>
                    <button class="modal-close" id="closeModalBtn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="setting-info">
                        <p class="readonly-notice">⚠️ 設定はサーバー側で管理されています（読み取り専用）</p>
                    </div>
                    <div class="setting-item">
                        <label for="homeLatitude">自宅緯度:</label>
                        <input type="text" id="homeLatitude" readonly placeholder="サーバーから取得中...">
                    </div>
                    <div class="setting-item">
                        <label for="homeLongitude">自宅経度:</label>
                        <input type="text" id="homeLongitude" readonly placeholder="サーバーから取得中...">
                    </div>
                    <div class="setting-item">
                        <label for="triggerDistance">トリガー距離 (m):</label>
                        <input type="text" id="triggerDistance" readonly placeholder="サーバーから取得中...">
                    </div>
                    <div class="setting-item">
                        <label for="debugMode">デバッグモード:</label>
                        <input type="checkbox" id="debugMode">
                    </div>
                </div>
                <div class="modal-footer">
                    <button id="saveSettingsBtn" class="btn btn-primary">保存</button>
                    <button id="cancelSettingsBtn" class="btn btn-outline">キャンセル</button>
                </div>
            </div>
        </div>

        <!-- Notification -->
        <div class="notification" id="notification">
            <span id="notificationText"></span>
        </div>

    </div>

    <!-- Scripts -->
    <script src="/app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
