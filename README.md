# SwitchBotä½ç½®æƒ…å ±è‡ªå‹•åˆ¶å¾¡ã‚·ã‚¹ãƒ†ãƒ 

iPhoneãŒè‡ªå®…ã‹ã‚‰100mé›¢ã‚ŒãŸæ™‚ã«ã€SwitchBot Hub2çµŒç”±ã§ã‚¨ã‚¢ã‚³ãƒ³ã‚’è‡ªå‹•åœæ­¢ã™ã‚‹PWAã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³

## ğŸ¯ æ¦‚è¦

- **ç›®çš„**: å¤–å‡ºæ™‚ã®ã‚¨ã‚¢ã‚³ãƒ³è‡ªå‹•åˆ¶å¾¡
- **ç‰¹å¾´**: ä½ç½®æƒ…å ±ãƒ™ãƒ¼ã‚¹ã§ã®SwitchBotãƒ‡ãƒã‚¤ã‚¹åˆ¶å¾¡
- **å¯¾è±¡**: iPhone Safariï¼ˆPWAå¯¾å¿œï¼‰

## ğŸ› ï¸ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: HTML5, CSS3, Vanilla JavaScript
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Node.js (Netlify Functions)
- **API**: SwitchBot API v1.1, Geolocation API
- **ãƒ‡ãƒ—ãƒ­ã‚¤**: GitHub Pagesï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰+ Netlify Functionsï¼ˆAPIï¼‰

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```text
/
â”œâ”€â”€ public/           # PWAãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ index.html   # ãƒ¡ã‚¤ãƒ³UI
â”‚   â”œâ”€â”€ manifest.json # PWAè¨­å®š
â”‚   â”œâ”€â”€ sw.js        # Service Worker
â”‚   â”œâ”€â”€ app.js       # ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ style.css    # ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â””â”€â”€ icons/       # PWAã‚¢ã‚¤ã‚³ãƒ³
â”œâ”€â”€ api/             # Netlify Functions
â”‚   â”œâ”€â”€ devices.js           # ãƒ‡ãƒã‚¤ã‚¹ä¸€è¦§å–å¾—
â”‚   â”œâ”€â”€ location-check.js    # ä½ç½®ãƒã‚§ãƒƒã‚¯ + åˆ¶å¾¡
â”‚   â””â”€â”€ test-aircon.js       # ã‚¨ã‚¢ã‚³ãƒ³ãƒ†ã‚¹ãƒˆåˆ¶å¾¡
â”œâ”€â”€ .github/workflows/       # GitHub Actions
â”‚   â”œâ”€â”€ deploy.yml          # PWAãƒ‡ãƒ—ãƒ­ã‚¤
â”‚   â””â”€â”€ deploy-api.yml      # APIãƒ‡ãƒ—ãƒ­ã‚¤
â”œâ”€â”€ docs/            # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ .env.example     # ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”œâ”€â”€ package.json     # ä¾å­˜é–¢ä¿‚
â””â”€â”€ netlify.toml     # Netlifyè¨­å®š
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### 1. ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
cp .env.example .env
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦ã€ä»¥ä¸‹ã®æƒ…å ±ã‚’è¨­å®šï¼š

- `SWITCHBOT_TOKEN`: SwitchBotã‚¢ãƒ—ãƒªã‹ã‚‰å–å¾—
- `SWITCHBOT_SECRET`: SwitchBotã‚¢ãƒ—ãƒªã‹ã‚‰å–å¾—
- `AIRCON_DEVICE_ID`: ã‚¨ã‚¢ã‚³ãƒ³ã®ãƒ‡ãƒã‚¤ã‚¹ID
- `HOME_LATITUDE`: è‡ªå®…ã®ç·¯åº¦
- `HOME_LONGITUDE`: è‡ªå®…ã®çµŒåº¦

### 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
npm run dev
```

### 4. ãƒ‡ãƒ—ãƒ­ã‚¤

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆGitHub Pagesï¼‰
1. GitHubãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥
2. GitHub ActionsãŒè‡ªå‹•ã§GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤

#### APIï¼ˆNetlify Functionsï¼‰
1. Netlifyã§ã‚µã‚¤ãƒˆä½œæˆ
2. GitHub Secretsã«ç’°å¢ƒå¤‰æ•°è¨­å®šï¼š
   - `NETLIFY_AUTH_TOKEN`
   - `NETLIFY_SITE_ID`
   - `SWITCHBOT_TOKEN`
   - `SWITCHBOT_SECRET`
   - `AIRCON_DEVICE_ID`
   - `HOME_LATITUDE`
   - `HOME_LONGITUDE`
   - `TRIGGER_DISTANCE`
3. APIãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã«è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

## ğŸ“± ä½¿ç”¨æ–¹æ³•

1. PWAã‚¢ãƒ—ãƒªã«ã‚¢ã‚¯ã‚»ã‚¹
2. ä½ç½®æƒ…å ±è¨±å¯ã‚’æ‰¿èª
3. ç›£è¦–é–‹å§‹ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—
4. è‡ªå®…ã‹ã‚‰100mé›¢ã‚Œã‚‹ã¨è‡ªå‹•ã§ã‚¨ã‚¢ã‚³ãƒ³ãŒåœæ­¢

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ­ãƒ¼ã‚«ãƒ«ãƒ†ã‚¹ãƒˆ

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
cp .env.example .env
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦å®Ÿéš›ã®å€¤ã‚’è¨­å®š

# APIãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
npm run test

# å€‹åˆ¥ãƒ†ã‚¹ãƒˆ
npm run test:api
```

### Netlify Devï¼ˆæ¨å¥¨ï¼‰

```bash
# Netlifyé–‹ç™ºç’°å¢ƒèµ·å‹•
npm run dev:api

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
open http://localhost:8888
```

- `main`: æœ¬ç•ªç’°å¢ƒç”¨
- `develop`: é–‹ç™ºçµ±åˆç”¨
- `feature/*`: æ©Ÿèƒ½åˆ¥é–‹ç™º

### ã‚³ãƒŸãƒƒãƒˆè¦ç´„

```bash
feat: æ–°æ©Ÿèƒ½è¿½åŠ 
fix: ãƒã‚°ä¿®æ­£
docs: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°
style: ã‚³ãƒ¼ãƒ‰ã‚¹ã‚¿ã‚¤ãƒ«ä¿®æ­£
refactor: ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
test: ãƒ†ã‚¹ãƒˆè¿½åŠ ãƒ»ä¿®æ­£
chore: è¨­å®šãƒ»ãƒ„ãƒ¼ãƒ«ä¿®æ­£
```

## ï¿½ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

## é‡è¦ï¼š190ã‚¨ãƒ©ãƒ¼ã«ã¤ã„ã¦

**190 ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯æ­£å¸¸å‹•ä½œã§ã™ï¼**

Hub2ã®èµ¤å¤–ç·šãƒ‡ãƒã‚¤ã‚¹ï¼ˆã‚¨ã‚¢ã‚³ãƒ³ç­‰ï¼‰ã§ã¯ã€ãƒ‡ãƒã‚¤ã‚¹ã®çŠ¶æ…‹å±¥æ­´ãŒã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸã•ã‚Œã¦ã„ãªã„ãŸã‚ã€`statusCode: 190` ãŒè¿”ã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯**ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãã€æ­£å¸¸ãªå‹•ä½œ**ã§ã™ã€‚

### ã‚¨ã‚¢ã‚³ãƒ³åˆ¶å¾¡ã®é‡è¦ãªä¿®æ­£

ğŸ”§ **2025-08-13 ä¿®æ­£å®Œäº†**

å¾“æ¥ã® `turnOn`/`turnOff` ã‚³ãƒãƒ³ãƒ‰ã§ã¯ã‚¨ã‚¢ã‚³ãƒ³ãŒç‰©ç†çš„ã«å‹•ä½œã—ã¾ã›ã‚“ã§ã—ãŸã€‚SwitchBotå…¬å¼APIä»•æ§˜ã«åŸºã¥ãã€ã‚¨ã‚¢ã‚³ãƒ³ã«ã¯ **`setAll` ã‚³ãƒãƒ³ãƒ‰**ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ä¿®æ­£ã—ã¾ã—ãŸï¼š

```javascript
// âŒ å¾“æ¥ï¼ˆå‹•ä½œã—ãªã„ï¼‰
{
    command: 'turnOff',
    parameter: 'default',
    commandType: 'command'
}

// âœ… ä¿®æ­£å¾Œï¼ˆå‹•ä½œã™ã‚‹ï¼‰
{
    command: 'setAll',
    parameter: '26,1,1,off',  // æ¸©åº¦,ãƒ¢ãƒ¼ãƒ‰,é¢¨é‡,é›»æºçŠ¶æ…‹
    commandType: 'command'
}
```

### setAllãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»•æ§˜
- **temperature**: æ¸©åº¦ï¼ˆä¾‹ï¼š26ï¼‰
- **mode**: 0/1=è‡ªå‹•, 2=å†·æˆ¿, 3=é™¤æ¹¿, 4=é€é¢¨, 5=æš–æˆ¿
- **fan speed**: 1=è‡ªå‹•, 2=ä½, 3=ä¸­, 4=é«˜
- **power state**: `on`=é›»æºON, `off`=é›»æºOFF

## ğŸš€ Netlify ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

### ãƒ­ãƒ¼ã‚«ãƒ«ã§æˆåŠŸã€Netlify ã§å¤±æ•—ã™ã‚‹åŸå› ã¨å¯¾ç­–

**å•é¡Œ**: ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ã‚¨ã‚¢ã‚³ãƒ³åˆ¶å¾¡ãŒæˆåŠŸã™ã‚‹ãŒã€Netlify ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯å¤±æ•—ã™ã‚‹

**åŸå› **:
1. **ç’°å¢ƒè¨­å®šã®é•ã„**: ãƒ­ãƒ¼ã‚«ãƒ«ï¼ˆ.env ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰vs Netlifyï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šï¼‰
2. **ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: Netlify Functions ã¯ 10ç§’åˆ¶é™
3. **ã‚³ãƒãƒ³ãƒ‰å½¢å¼**: setAll ã‚³ãƒãƒ³ãƒ‰ã¸ã®ä¿®æ­£ãŒå¿…è¦

**è§£æ±ºæ¸ˆã¿ä¿®æ­£**:
- âœ… ã™ã¹ã¦ã® API ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ `dotenv` å‰Šé™¤
- âœ… ã‚¨ã‚¢ã‚³ãƒ³åˆ¶å¾¡ã‚’ `setAll` ã‚³ãƒãƒ³ãƒ‰ã«ä¿®æ­£
- âœ… è¨ºæ–­æ©Ÿèƒ½ã®ç°¡ç´ åŒ–ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆå¯¾ç­–ï¼‰

### Netlify ç’°å¢ƒå¤‰æ•°è¨­å®š

Netlify Dashboard > Site settings > Environment variables ã§ä»¥ä¸‹ã‚’è¨­å®šï¼š

```
SWITCHBOT_TOKEN=your_token_here
SWITCHBOT_SECRET=your_secret_here
AIRCON_DEVICE_ID=your_device_id_here
HOME_LATITUDE=your_latitude_here
HOME_LONGITUDE=your_longitude_here
TRIGGER_DISTANCE=100
```

## ï¿½ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

MIT License

---

è©³ç´°ãªå®Ÿè£…ä»•æ§˜ã«ã¤ã„ã¦ã¯ã€[PWAå®Ÿè£…ä»•æ§˜æ›¸](docs/PWA-Implementation-Specification.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
