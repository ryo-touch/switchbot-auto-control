# SwitchBot Hub2 API エアコン操作トラブル事例集

実際のユーザー体験、開発者フォーラム、GitHub issues、公式ドキュメントから収集した SwitchBot Hub2 の API を使用したエアコン操作における問題とトラブル事例を包括的にまとめました。日本語コミュニティの詳細な技術記事から英語開発者フォーラムの討議まで、実践的なトラブルシューティング情報を網羅しています。

**SwitchBot Hub2 の API エアコン制御は複数の技術的制約と既知の問題を抱えており**、特に認証タイムアウト（5分制限）、ネットワーク設定の制約（2.4GHz専用）、API レスポンスの不安定性が主要な課題として浮上しています。実際のユーザー報告では、**エラー率が1-4%程度で発生**し、特定の環境では **API 190 内部サーバーエラーが5-30分に1回発生**する深刻な事例も確認されています。

## API 認証と接続エラーの実態

### 403 Forbidden エラーの突発的発生

GitHub の公式 SwitchBot API リポジトリ（Issue #374）では、**以前は正常に動作していた統合が突然 403 Forbidden エラーを返す問題**が報告されています。この問題は複数のユーザーに影響し、公式 README のサンプルコードでさえも同じエラーが発生する状況です。

Zenn の技術記事では、より具体的な認証問題として **API v1.1 の timestamp 有効期限切れ（約5分）**が詳細に分析されています。開発者は `SwitchBot API server returns status 401` エラーに遭遇し、**リクエストごとに SwitchBot Client を再作成する必要がある**ことが判明しました。

### API レート制限の実用的制約

公式ドキュメントでは **1日10,000リクエストの制限**が明記されていますが、実際の運用では **「Unauthorized」レスポンスが限界値を超える前に発生**する事例が確認されています。Home Assistant コミュニティでは、**最低10分間隔でのポーリングを推奨**し、ローカル キャッシュ実装やWebhook の活用が解決策として提案されています。

## エアコン制御固有の技術的問題

### 温度設定の API パラメータ問題

Home Assistant Core の Pull Request #132231 では、**SwitchBot API が小数点温度値を受け付けなくなった変更**が文書化されています。以前は動作していた浮動小数点数での温度設定が、**API バックエンドの変更により整数値のみ受け付ける仕様に変更**されました。

Homebridge GitHub Issues では、具体的な **パラメータ フォーマット エラー**（`"parameter":"%s,%s,%s,%s"` が実際の値ではなく文字列プレースホルダーとして送信される）が報告されており、**物理デバイスが API コマンドに応答しない根本的な原因**となっています。

### Apple HomeKit との温度制御制限

英語開発者フォーラムの詳細な調査では、**Apple HomeKit 経由での AC 温度制御が特定のモードで失敗する**問題が特定されています。自動モードでは温度が 25°C に固定され、パラメータが `[25, 1, 1, on]` に制限される制約があります。Native HomeKit 統合では実際の温度設定が反映されず、**SwitchBot アプリでの直接制御が必要**な状況です。

### 複数ハブ環境での競合問題

Homebridge の Discussion #992 では、**Hub2 と Hub Mini が同一アカウントに存在する場合の深刻な競合問題**が報告されています。両方のハブが存在すると `Maximum call stack size exceeded` エラーが発生し、デバイス探索が完全に失敗します。現在の回避策は **片方のハブ タイプを削除**することのみです。

## 日本語コミュニティからの詳細なエラーコード解析

### 190 内部エラーの多面的原因

greenpuddle.net の包括的なエラーコード ガイドでは、**API エラー 190**（内部エラー）の詳細な原因分析が提供されています：

- **サーバー応答不能**: クラウド サービス側の一時的障害
- **デバイス接続不能**: Bluetooth 接続の問題
- **電源出力不足**: 5V 1A未満のアダプター使用
- **タイムエラー**: ハブとデバイス間の距離問題

実際のユーザー体験では、**Wi-Fi ルーターの再起動と 2A 以上のアダプター使用**が最も効果的な解決策として確認されています。

### ネットワーク設定の実践的ガイドライン

bot-lab.tech の詳細なトラブルシューティング記事では、**5段階の体系的な問題解決手順**が提示されています：

1. **バージョン更新確認**: アプリ、OS、ファームウェアの同期
2. **ネットワーク設定見直し**: 2.4GHz専用接続の確認
3. **赤外線通信状況改善**: 最大30m範囲での障害物除去
4. **エアコン登録確認**: 自動・手動・ボタン学習の再実行
5. **サポート問い合わせ**: 電話サポート（0120-202-362）

## Home Assistant 統合での具体的問題

### 温湿度データ アクセス失敗

Home Assistant コミュニティ フォーラムでは、**Hub2 から温湿度データを読み取れない問題**が広く報告されています。AC 制御コマンドは機能するが、センサー データが `unreadable` 状態になる現象です。解決策として **SwitchBot API を直接使用したカスタム REST センサー**の実装が推奨されています。

### HVAC モード制御の回帰問題

Home Assistant Core Issue #130516 では、**2024.11.1 アップデート以降に HVAC モード変更が常に冷房に切り替わる回帰**が報告されています。以前のバージョン（2024.10.x）では正常に動作していた暖房モード機能が完全に失われました。

## 公式制限と設計上の制約

### IRデコード機能のベータ版制限

公式ドキュメントでは、**IR デコード機能が約1,800機種のみサポートするベータ版機能**であることが明記されています。この機能を利用するには：

- **SwitchBot App V8.8 以上**が必要
- **R&D チームによるアカウント ホワイトリスト登録**が必要
- **Hub2 が AC リモコン信号を受信できない同期失敗**が頻発

### Matter 統合の前提条件問題

公式サポート文書では、**Matter 統合に IPv6 サポートが必須**であることが明記されていますが、同時に「現在 IPv6 ネットワークと Wi-Fi 6 ルーターはサポートされていません」という矛盾した制限も存在します。

## 実測されたエラー率とパフォーマンス

### オートメーション機能の統計的分析

note.com のユーザー投稿では、**2024年1月時点での実際のエラー率統計**が公開されています：

- **1月9日**: 457回中17回失敗（**エラー率3.72%**）
- **1月10日**: 401回中5回失敗（**エラー率1.25%**）
- **1月11日**: 354回中12回失敗（**エラー率3.39%**）

**Hub1 と比較して Hub2 の方がエラー率が高い傾向**があり、Hub1 をメイン、Hub2 をバックアップとする運用が推奨されています。

### 継続的な API 安定性問題

Zenn の技術記事では、**HTTP 500 Internal Server Error が5-30分に1回程度発生**し、特に tailscale 使用環境で頻発することが報告されています。DNS 解決失敗（api.switch-bot.com への接続不能）も定期的に発生し、**API の根本的な安定性に課題**があることが判明しています。

## 効果的なトラブルシューティング戦略

### 段階的問題解決アプローチ

日英両コミュニティの経験を統合した **5段階トラブルシューティング プロセス**：

**第1段階 - 基本環境確認**
- アプリとファームウェアの最新化
- 2.4GHz Wi-Fi 接続の確認
- 5V2A以上の電源アダプター使用

**第2段階 - 物理環境最適化**
- ハブとエアコン間の距離短縮（同室内推奨）
- 赤外線通信の障害物除去
- 金属オブジェクトの配置変更

**第3段階 - ネットワーク環境改善**
- Wi-Fi ルーターの再起動（10分間隔）
- Bluetooth 機能リセット
- 固定 IP アドレス設定の検討

**第4段階 - API 実装改善（開発者向け）**
- 認証情報の定期的更新実装
- エラーハンドリングとリトライ機能強化
- ローカル キャッシュによる API 呼び出し削減

**第5段階 - 代替手段の検討**
- Bluetooth 直接統合による API 制限回避
- 複数プラットフォーム統合（Cloud + Bluetooth）
- SwitchBot アプリでの直接制御への回帰

## 結論と今後の展望

SwitchBot Hub2 の API を使用したエアコン操作は、**技術的に実現可能である一方で、多くの制約と既知の問題を抱えている**現状です。認証タイムアウト、ネットワーク制限、API安定性の問題は構造的な課題であり、開発者は **robust な エラーハンドリング と代替手段の実装が不可欠**です。

日本語と英語両コミュニティの豊富な経験は、これらの問題に対する実践的な解決策を提供していますが、**公式な API 改善とドキュメント充実がさらなる安定性向上の鍵**となります。現在進行中の GitHub issues や公式サポートへのフィードバックが、将来的な改善に重要な役割を果たすと期待されます。
